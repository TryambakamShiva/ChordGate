<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Chord Gate</title>
    <script src="{{url_for('static', filename='chords.js')}}"></script>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"
        integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
    crossorigin="anonymous">
    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous">
    </script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Sofia">
<link href="https://fonts.googleapis.com/css2?family=Taviraj" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body style="background-color:#faf0cf;">
  <header>
  <nav>
  
    <div class="container-fluid" style = "background-color: #fde38e;"><div class="row">
      <div class="col-md-12 col-xs-12 col-sm-12 col-lg-12">   
      <br><center><i class='fa fa-music' style='font-size:28px; color:black;'></i> &nbsp;
      <label style= "color:rgb(1, 29, 15); font-family: Taviraj, serif; font-weight: bold; font-size: 26px;">Chord Gate</label>
      &nbsp; <i class='fa fa-music fa-flip-horizontal' style='font-size:28px; color:black;'></i>
    </center>
      <br>

  </div></div></div>
  
  </nav>
  </header>    <br>
  
  <marquee style = "color:rgb(1, 29, 15); font-family: Taviraj, serif; font-size: 22px;">
    <i class='fa fa-music' style='font-size:22px; color:black;'></i> &nbsp; Without music, life would be a mistake. -- Friedrich Nietzsche
    &nbsp; <i class='fa fa-music fa-flip-horizontal' style='font-size:22px; color:black;'></i> </marquee> <br>
  <br>

  
  <center><div class="container-fluid"><div class="row">
    <div class="col-md-3 col-xs-3 col-sm-3 col-lg-3" style = "background-color: #faf0cf;">
    
      <img src="{{url_for('static', filename='gif1.gif')}}" width='90%' height='90%'>
    </div>

  <div class="col-md-6 col-xs-6 col-sm-6 col-lg-6" style = "background-color: white;">
<form id ="main" method="post" enctype="multipart/form-data" name="formUploadFile">
<br><a><label class="filebutton" style= "color:black; font-family: normal; background-color: white;">
Upload Audio (Only MP3, WAV, AIFF and FLAC Files Upto 25 MB) <i class="fa fa-file-audio-o" aria-hidden="true" style= "color:black;"></i><br><br>
    <input type="file" id="fileInput2" title = "Only MP3, WAV, AIFF and FLAC Audio Files Upto 25 MB" name="imagenew" 
    accept="audio/MP3,audio/mpeg,audio/WAV,audio/AIFF,audio/x-aiff,audio/FLAC,audio/x-flac,audio/x-wav">
    <br><br> <label style = "background-color: azure; color: brown; font-weight:bold;"> For Best Results Upload MP3 Audio-Files (Upto 25 MB) </label>
  </label>
    </a><br><br>   
     
    <center>
    <button id ="button" type="submit" name ="btnSubmit" value="Upload File" class="btn btn-primary" style="font-family: normal; background-color: black;">Submit</button>
    </center><br>
    <label style = "background-color: azure; color:brown; font-family: normal;">
      <i class='fa fa-music' style='color:black;'></i> &nbsp; Generate Guitar Chords and Chord-Diagram from Audio Files.
      &nbsp; <i class='fa fa-music fa-flip-horizontal' style='color:black;'></i> </label>

    </form> 
  

</div>

<div class="col-md-3 col-xs-3 col-sm-3 col-lg-3" style = "background-color: #faf0cf;">
    
  <img src="{{url_for('static', filename='gif3.gif')}}" width='90%' height='90%'>
</div>


</div></div></center>
 <br>

<div id='loader' style='display: none;'><br>   <center>
  <img src="{{url_for('static', filename='loader.gif')}}"  width='150px' height='200px'></center>
</div>
<div id='loader2' style='display: none;'><br>   <center>
    <img src="{{url_for('static', filename='loader2.gif')}}"  width='200px' height='267px'></center>
  </div>


<center><button id="5" class="btn btn-primary"  type="button" style="display: none; background-color: black;">Download PDF for Generated Chords</button>
</center>
  <br>
  <div id='loader3' style='display: none;'><br>   <center>
    <img src="{{url_for('static', filename='loader3.gif')}}"  width='150px' height='200px'></center>
  </div>
  <br>

<center><div id="result" class="col-md-12 col-xs-12 col-sm-12 col-lg-12" style = "background-color: #fae397;"></div></center>
<br><br>

<div id="output" style ="visibility: hidden;"></div> <br><br>



<div id="container" style = "background-color: white;">
    <div id="output2" style = "background-color: #fff2c7;"></div>
  </div><br><br>

</body>
<br>   <br>
<div class="container-fluid" style = "background-color: #fde38e;"><div class="row">
  <div class="col-md-12 col-xs-12 col-sm-12 col-lg-12">   
  
  <br>
  <center>
    <a href = "http://localhost/flask7/Docs/Disclaimer.php" style ='font-family:normal; color: rgb(1, 29, 15); font-weight: bold;'>Disclaimer</a>&nbsp;&nbsp;
    <a href = "http://localhost/flask7/Docs/Privacy_Policy.php" style ='font-family:normal; color: rgb(1, 29, 15); font-weight: bold;'>Privacy Policy</a>&nbsp;&nbsp;
    <a href = "http://localhost/flask7/Docs/About_Us.php" style ='font-family:normal; color: rgb(1, 29, 15); font-weight: bold;'>About Us</a>&nbsp;&nbsp;
    <a href = "http://localhost/flask7/Docs/Contact.php" style ='font-family:normal; color: rgb(1, 29, 15); font-weight: bold;'>Contact</a>&nbsp;&nbsp;

    <img src="http://localhost/flask7/Docs/logo.png" style = 'width:25px; height:25px; border-radius: 50%; float:right;'>
  </center>
  <br>

</div></div></div>

</html>
<script>

$(document).ready(function () {
  $("#main").submit(function (event) {

      event.preventDefault();

      var formData = new FormData($(this)[0]);
      $("#loader").show();

      $.ajax({
          url: 'http://localhost/flask7/templates/getdata.php',
          type: 'POST',
          data: formData,
          async: false,
          cache: false,
          contentType: false,
          processData: false,
          success: function (formData) {

            if(formData==1){
              $("#loader").hide();
              confirm("Warning: Audio-file Mime-Type is not in database and File is Not Procesed. For Best Results, try to upload MP3 Audio-File. Click Ok and page wiil be refreshed.");
              window.location.reload();
            }
            else if(formData==2){
              $("#loader").hide();
              confirm("Warning: There was Some Problem and Your Audio is not Processed. Click Ok and page wiil be refreshed. Then Try Again.");
              window.location.reload();
            }
            else if(formData==3){
              $("#loader").hide();
              confirm("Warning: Audio File Type Not Correct. For Best Results, try to upload MP3 Audio-File. Click Ok and page wiil be refreshed. Then Try Again.");
              window.location.reload();
              
            }
            else if(formData==4){
              $("#loader").hide();
              confirm("Warning: Audio File needs to be Uploaded. Please Select an audio file first and then submit. Click Ok and page wiil be refreshed.");
              window.location.reload();
            }
            else if(formData==5){
              $("#loader").hide();
              confirm("Warning: Audio File-Size can not be greater than 25 MB. Click Ok and page wiil be refreshed.");
              window.location.reload();
            }
             
            else{
            $("#loader").hide();
            $("#loader2").show();
              document.getElementById("main").reset();
              $("button#5").css("display", "none");


              var valuek = formData;

              $.ajax({
                url: '/process',
                type: 'POST',
                contentType: 'application/json',
                headers: {                                  
        'Accept': 'application/json',
        'Charset': 'UTF-8',
        'Content-Type': 'application/json' 
    },
                data: JSON.stringify({ 'value': valuek }),

                success: function(response) {

                    $('#result').load('/chord');
                    document.getElementById('output').innerHTML = response.result;

var dataToSend = "variableName=" + encodeURIComponent(document.getElementById('output').innerHTML);

var xhr = new XMLHttpRequest();

xhr.open("POST", "http://localhost/flask7/templates/loaddata.php", true);

xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

xhr.onreadystatechange = function () {
    if (xhr.readyState === XMLHttpRequest.DONE) {

        if (xhr.status === 200) {
            $("#loader2").hide();

             document.getElementById('output2').innerHTML = xhr.responseText;
             var script = document.createElement("script");
             script.src= "http://localhost/flask7/static/chords.js";
             document.body.appendChild(script);
             chords.replace();
             $("button#5").css("display", "block");
            
//---------------  Following Code is Based on html2canvas by niklasvh ( https://github.com/niklasvh/html2canvas ) --------------//
//---------------- AND ----------//
//---------------- jsPDF  by parallax ( https://github.com/parallax/jsPDF ) --------------//
//--------------------------------------------//
//  *** html2canvas (MIT License) ***
//Copyright (c) 2012 Niklas von Hertzen

//Permission is hereby granted, free of charge, to any person
//obtaining a copy of this software and associated documentation
//files (the "Software"), to deal in the Software without
//restriction, including without limitation the rights to use,
//copy, modify, merge, publish, distribute, sublicense, and/or sell
//copies of the Software, and to permit persons to whom the
//Software is furnished to do so, subject to the following
//conditions:

//The above copyright notice and this permission notice shall be
//included in all copies or substantial portions of the Software.

//THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
//EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
//OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
//NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
//HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
//WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
//FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
//OTHER DEALINGS IN THE SOFTWARE.

//--------------------------------------------//
// *** jsPDF (MIT License) ***
// Copyright
// (c) 2010-2025 James Hall, https://github.com/MrRio/jsPDF
// (c) 2015-2025 yWorks GmbH, https://www.yworks.com/

// Permission is hereby granted, free of charge, to any person obtaining
// a copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to
// permit persons to whom the Software is furnished to do so, subject to
// the following conditions:

// The above copyright notice and this permission notice shall be
// included in all copies or substantial portions of the Software.

// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
// NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
// LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
// OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
// WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
//--------------------------------------------//
//--------------------------------------------//
  window.jsPDF = window.jspdf.jsPDF;
  $(function () {
    $("#5").click(function (e) {
        e.preventDefault();
    const input = document.getElementById("output2");
    $("#loader3").show();
    html2canvas(input, {
      logging: true,
      letterRendering: 1,
      scale: 2,
      windowWidth: 1440,
      useCORS: true
    }).then((canvas) => {
      var imgData = canvas.toDataURL("image/png");
      var imgWidth = 630;
      var pageHeight = 885;
      var imgHeight = (canvas.height * imgWidth) / canvas.width;
      var heightLeft = imgHeight;
      var doc = new jsPDF('p', 'pt','a4',true);
      var position = 0;
      doc.addImage(imgData, "jpeg", 0, position, imgWidth, imgHeight);
      heightLeft -= pageHeight;
      while (heightLeft >= 0) {
        position = heightLeft - imgHeight;
        doc.addPage();
        doc.addImage(imgData, "jpeg", 0, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;
      }

      const pages = doc.internal.getNumberOfPages();

      for (let j = 1; j < pages + 1; j++) {
        let horizontalPos = imgWidth / 4; 
        let verticalPos = pageHeight - 20; 
        doc.setPage(j);
        doc.setFontSize(10);
        doc.text(`${j} of ${pages}`, horizontalPos, verticalPos, {
          align: "center" 
        });
      }

      doc.save("Chords_Extracted.pdf");
      $("#loader3").hide();
    });
  });
});      

        } else {

            $("#loader2").hide();
             confirm("Failure: Chords were extracted but could not be inserted in Database. Chord-Diagram could not be generated. Click Ok and page wiil be refreshed.");
             window.location.reload();
        }

    }

}
    ;
xhr.send(dataToSend);

                },
                error: function(error) {

                    $("#loader2").hide();
             confirm("Failure: Chords could not be extracted. Click Ok and page wiil be refreshed and then try again with another file.");
             window.location.reload();
                }
            });

          }    
          },

          error:function(formData){
        alert("Some Internal Server Error Occured. Please Refresh and Try Again Later."); 
        window.location.reload();
    }
      });

      return false;
  });
});
</script>




